<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Caverna BJJ</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />
  <style>
   body {
  font-family: 'Segoe UI', sans-serif;
  background: #f3f5f8;
  margin: 0;
  padding: 10px;
  color: #333;
}

h1 {
  text-align: center;
  color: #002b5c;
  margin-bottom: 10px;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  max-width: 95%;
  margin: 15px auto;
  box-sizing: border-box;
}

label {
  display: block;
  margin-top: 15px;
  font-weight: 600;
  font-size: 14px;
}

select {
  width: 100%;
  padding: 10px 12px;
  font-size: 15px;
  border-radius: 10px;
  border: 1px solid #ccc;
  margin-top: 5px;
  box-sizing: border-box;
}

button {
  width: 100%;
  padding: 14px;
  margin-top: 12px;
  border-radius: 10px;
  font-size: 16px;
  font-weight: bold;
  border: none;
  color: white;
  background: #004085;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: background 0.3s ease;
}

button:hover {
  background: #002b5c;
}

button.secondary {
  background: #6c757d;
}

button.secondary:hover {
  background: #5a6268;
}

button.icon-button {
  font-size: 14px;
  background: #e4e6eb;
  color: #333;
  padding: 8px 12px;
  width: auto;
  margin-top: 0;
}

.sugestao, .treino {
  margin-top: 25px;
}

.sugestao h3, .treino h3 {
  margin-bottom: 10px;
  color: #004085;
}

ul {
  padding-left: 20px;
}

.checklist input {
  margin-right: 10px;
  transform: scale(1.3);
}

input[type="text"] {
  width: 100%;
  padding: 10px 12px;
  font-size: 16px;
  margin: 8px 0 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
  box-sizing: border-box;
}

.tag-group {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 10px 0 20px;
}

.tag-group label {
  background: #e7f0ff;
  border: 1px solid #004085;
  border-radius: 30px;
  padding: 8px 12px;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.tag-group {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 10px 0 20px;
}

.tag-group label {
  border: 1px solid #004085;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.2s ease;
  background: #e7f0ff;
}

.tag-group input[type="checkbox"] {
  display: none;
}

.tag-group span {
  display: inline-block;
  padding: 8px 14px;
  font-size: 14px;
  color: #004085;
  border-radius: 30px;
}

.tag-group input[type="checkbox"]:checked + span {
  background: #004085;
  color: #fff;
}


  </style>
</head>
<body>
  <h1>Caverna BJJ</h1>
  <div class="card" id="perfilCard">
    <h2>âš™ï¸ Configurar Perfil</h2>
  
    <label for="nomePerfil">Seu nome/apelido:</label>
    <input type="text" id="nomePerfil" placeholder="Ex: Alan" />
  
    <label>Onde treina?</label>
    <div class="tag-group" id="locais">
      <label><input type="checkbox" value="Casa"><span>ğŸ  Casa</span></label>
      <label><input type="checkbox" value="PraÃ§a"><span>ğŸŒ³ PraÃ§a</span></label>
      <label><input type="checkbox" value="Academia"><span>ğŸ‹ï¸ Academia</span></label>
    </div>    
  
    <label>Equipamentos disponÃ­veis:</label>
    <div class="tag-group" id="equipamentos">
      <label><input type="checkbox" value="Halteres"><span>ğŸ‹ï¸ Halteres</span></label>
      <label><input type="checkbox" value="ElÃ¡stico"><span>ğŸ§µ ElÃ¡stico</span></label>
      <label><input type="checkbox" value="Saco de pancada"><span>ğŸ¥Š Saco de pancada</span></label>
      <label><input type="checkbox" value="Barra fixa"><span>ğŸš§ Barra fixa</span></label>
      <label><input type="checkbox" value="Banco abdominal"><span>ğŸª‘ Banco abdominal</span></label>
      <label><input type="checkbox" value="Tornozeleira"><span>ğŸ¦µ Tornozeleira</span></label>
    </div>
    
    <label>Objetivos:</label>
    <div class="tag-group" id="objetivos">
      <label><input type="checkbox" value="Desempenho no Jiu-Jitsu"><span>ğŸ¥‹ Jiu-Jitsu</span></label>
      <label><input type="checkbox" value="ForÃ§a"><span>ğŸ’ª ForÃ§a</span></label>
      <label><input type="checkbox" value="Condicionamento"><span>ğŸƒâ€â™‚ï¸ Condicionamento</span></label>
      <label><input type="checkbox" value="Mobilidade"><span>ğŸ¤¸ Mobilidade</span></label>
      <label><input type="checkbox" value="PrevenÃ§Ã£o de LesÃ£o"><span>ğŸ›¡ï¸ PrevenÃ§Ã£o</span></label>
    </div>
    
  
    <button onclick="salvarPerfil()">ğŸ’¾ Salvar Perfil</button>
  </div>
  
  <div class="card" id="mainCard">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
      <div style="flex: 1; min-width: 180px;">
        <label for="tempo"><strong>â±ï¸ Tempo disponÃ­vel:</strong></label>
        <select id="tempo">
          <option value="15">15 min</option>
          <option value="30">30 min</option>
          <option value="45">45 min</option>
          <option value="60">60 min</option>
        </select>
      </div>
      <div style="flex: 1; min-width: 180px;">
        <label for="intensidade"><strong>ğŸ”¥ Intensidade:</strong></label>
        <select id="intensidade">
          <option value="leve">Leve</option>
          <option value="media">MÃ©dia</option>
          <option value="intensa">Intensa</option>
        </select>
      </div>
      <div style="flex: 1; min-width: 180px; text-align: right; margin-top: 28px;">
        <button onclick="editarPerfil()" style="background: #6c757d;">âœï¸ Editar Perfil</button>
      </div>
    </div>
  
    <hr style="margin: 20px 0;"/>
  
    <button onclick="sugerirGrupo()">ğŸ” Sugerir Grupo</button>
    <div class="sugestao" id="sugestao" style="margin-top: 20px;"></div>
  
    <button onclick="gerarTreino()">âœ… Gerar Treino do Dia</button>
    <button onclick="exportarTreino()">â¬‡ï¸ Exportar HistÃ³rico</button>
  
    <div class="treino" id="treino" style="margin-top: 20px;"></div>
  </div>

<div class="card" id="historicoCard" style="display: none;">
  <h2>ğŸ“Š HistÃ³rico de Treinos</h2>

  <!-- Filtros -->
  <div style="margin-bottom: 20px;">
    <label for="filtroData">Filtrar por data:</label>
    <input type="date" id="filtroData" />

    <label for="filtroMembro" style="margin-left: 20px;">Filtrar por membro:</label>
    <select id="filtroMembro">
      <option value="">Todos</option>
      <option value="ombro">Ombro</option>
      <option value="core">Core</option>
      <option value="pernas">Pernas</option>
      <option value="fullbody">Fullbody</option>
      <option value="cardio">Cardio</option>
      <option value="joelho">Joelho</option>
      <option value="dedos">Dedos</option>
    </select>

    <label for="filtroObjetivo" style="margin-left: 20px;">Filtrar por objetivo:</label>
    <select id="filtroObjetivo">
      <option value="">Todos</option>
      <option value="forca">ForÃ§a</option>
      <option value="mobilidade">Mobilidade</option>
      <option value="core">Core</option>
      <option value="condicionamento">Condicionamento</option>
      <option value="resistencia">ResistÃªncia</option>
    </select>
  </div>

  <!-- Tabela do HistÃ³rico -->
  <table border="1" width="100%" style="border-collapse: collapse; margin-bottom: 20px;">
    <thead>
      <tr>
        <th>Data</th>
        <th>Membro</th>
        <th>Objetivo</th>
        <th>Tempo</th>
        <th>Intensidade</th>
      </tr>
    </thead>
    <tbody id="tabelaHistorico">
      <!-- ConteÃºdo gerado dinamicamente -->
    </tbody>
  </table>

  <!-- AvaliaÃ§Ã£o do HistÃ³rico -->
  <div id="avaliacaoHistorico" style="margin-bottom: 20px;">
    <h3>ğŸ“ˆ AvaliaÃ§Ã£o do HistÃ³rico</h3>
    <p id="avaliacaoResumo"></p>
  </div>

  <!-- BotÃ£o de ExportaÃ§Ã£o -->
  <button onclick="exportarHistorico()">â¬‡ï¸ Exportar HistÃ³rico</button>
</div>
  
  <script>
    let dadosTreinos = {
  "ombro": [
    {
      "nome": "Wall Angels (3x15)",
      "subgrupo": "mobilidade",
      "equipamentos": [],
      "objetivo": [
        "mobilidade",
        "jiujitsu"
      ],
      "peso": 1
    },
    {
      "nome": "Shrug com halteres (3x12)",
      "subgrupo": "forca",
      "equipamentos": [
        "halteres"
      ],
      "objetivo": [
        "forca"
      ],
      "peso": 3
    },
    {
      "nome": "ElevaÃ§Ã£o lateral (2x15)",
      "subgrupo": "forca",
      "equipamentos": [
        "halteres"
      ],
      "objetivo": [
        "forca",
        "mobilidade"
      ],
      "peso": 3
    },
    {
      "nome": "RotaÃ§Ã£o externa com elÃ¡stico (3x15)",
      "subgrupo": "reabilitaÃ§Ã£o",
      "equipamentos": [
        "elastico"
      ],
      "objetivo": [
        "mobilidade"
      ],
      "peso": 1
    },
    {
      "nome": "Frontal raise com halteres (2x12)",
      "subgrupo": "forca",
      "equipamentos": [
        "halteres"
      ],
      "objetivo": [
        "forca"
      ],
      "peso": 3
    },
    {
      "nome": "PÃªndulo com peso (3x20s)",
      "subgrupo": "reabilitaÃ§Ã£o",
      "equipamentos": [
        "halteres"
      ],
      "objetivo": [
        "mobilidade"
      ],
      "peso": 1
    },
    {
      "nome": "Press militar (3x10)",
      "subgrupo": "forca",
      "equipamentos": [
        "halteres",
        "barra"
      ],
      "objetivo": [
        "forca"
      ],
      "peso": 3
    },
    {
      "nome": "Remada face pull com elÃ¡stico (3x12)",
      "subgrupo": "estabilidade",
      "equipamentos": [
        "elastico"
      ],
      "objetivo": [
        "mobilidade",
        "postura"
      ],
      "peso": 2
    },
    {
      "nome": "Isometria escapular na parede (2x45s)",
      "subgrupo": "estabilidade",
      "equipamentos": [],
      "objetivo": [
        "mobilidade"
      ],
      "peso": 2
    },
    {
      "nome": "SerrÃ¡til ativaÃ§Ã£o + push-up (3x10)",
      "subgrupo": "estabilidade",
      "equipamentos": [],
      "objetivo": [
        "postura",
        "mobilidade"
      ],
      "peso": 2
    }
  ],
  "core": [
    {
      "nome": "Prancha frontal (3x30s)",
      "subgrupo": "estabilidade",
      "equipamentos": [],
      "objetivo": [
        "core",
        "jiujitsu"
      ],
      "peso": 2
    },
    {
      "nome": "Canivete (3x15)",
      "subgrupo": "forca",
      "equipamentos": [],
      "objetivo": [
        "core"
      ],
      "peso": 3
    },
    {
      "nome": "Abdominal inclinado (3x20)",
      "subgrupo": "forca",
      "equipamentos": [
        "banco"
      ],
      "objetivo": [
        "forca"
      ],
      "peso": 3
    },
    {
      "nome": "Prancha com elevaÃ§Ã£o de pernas (3x30s)",
      "subgrupo": "estabilidade",
      "equipamentos": [],
      "objetivo": [
        "core",
        "equilibrio"
      ],
      "peso": 3
    },
    {
      "nome": "Dead Bug com halteres (3x10)",
      "subgrupo": "estabilidade",
      "equipamentos": [
        "halteres"
      ],
      "objetivo": [
        "core",
        "coordenaÃ§Ã£o"
      ],
      "peso": 3
    },
    {
      "nome": "Russian Twist (3x20)",
      "subgrupo": "forca",
      "equipamentos": [],
      "objetivo": [
        "core"
      ],
      "peso": 2
    },
    {
      "nome": "Prancha lateral (3x30s cada lado)",
      "subgrupo": "estabilidade",
      "equipamentos": [],
      "objetivo": [
        "core",
        "equilibrio"
      ],
      "peso": 2
    }
  ],
  "pernas": [
    {
      "nome": "Agachamento com halteres (3x12)",
      "subgrupo": "forca",
      "equipamentos": [
        "halteres"
      ],
      "objetivo": [
        "forca",
        "resistencia"
      ],
      "peso": 3
    },
    {
      "nome": "Passada com tornozeleira (3x10)",
      "subgrupo": "forca",
      "equipamentos": [
        "tornozeleira"
      ],
      "objetivo": [
        "forca",
        "mobilidade"
      ],
      "peso": 3
    },
    {
      "nome": "Adutor com elÃ¡stico (2x15)",
      "subgrupo": "isolamento",
      "equipamentos": [
        "elastico"
      ],
      "objetivo": [
        "estabilidade"
      ],
      "peso": 2
    },
    {
      "nome": "AvanÃ§o frontal com peso (3x10)",
      "subgrupo": "forca",
      "equipamentos": [
        "halteres"
      ],
      "objetivo": [
        "forca"
      ],
      "peso": 3
    },
    {
      "nome": "Pistol squat assistido (3x8)",
      "subgrupo": "controle",
      "equipamentos": [],
      "objetivo": [
        "mobilidade",
        "controle motor"
      ],
      "peso": 4
    },
    {
      "nome": "ElevaÃ§Ã£o de panturrilha (3x20)",
      "subgrupo": "isolamento",
      "equipamentos": [],
      "objetivo": [
        "resistencia"
      ],
      "peso": 2
    },
    {
      "nome": "SumÃ´ deadlift (3x10)",
      "subgrupo": "forca",
      "equipamentos": [
        "halteres",
        "barra"
      ],
      "objetivo": [
        "forca",
        "adutores"
      ],
      "peso": 4
    }
  ],
  "fullbody": [
    {
      "nome": "Burpee + saco de pancada (4x30s)",
      "subgrupo": "resistencia",
      "equipamentos": [
        "saco"
      ],
      "objetivo": [
        "condicionamento"
      ],
      "peso": 4
    },
    {
      "nome": "Jumping Jack + prancha (3x45s)",
      "subgrupo": "cardio",
      "equipamentos": [],
      "objetivo": [
        "condicionamento",
        "core"
      ],
      "peso": 3
    },
    {
      "nome": "Circuito livre funcional (5 min)",
      "subgrupo": "misturado",
      "equipamentos": [],
      "objetivo": [
        "resistencia",
        "agilidade"
      ],
      "peso": 3
    },
    {
      "nome": "Deslocamento com socos no saco (4x1min)",
      "subgrupo": "agilidade",
      "equipamentos": [
        "saco"
      ],
      "objetivo": [
        "coordenaÃ§Ã£o",
        "agilidade"
      ],
      "peso": 3
    },
    {
      "nome": "Agachamento + puxada elÃ¡stica (3x12)",
      "subgrupo": "combinado",
      "equipamentos": [
        "elastico"
      ],
      "objetivo": [
        "forca",
        "core"
      ],
      "peso": 3
    },
    {
      "nome": "Push-up + remo com halteres (3x10)",
      "subgrupo": "combinado",
      "equipamentos": [
        "halteres"
      ],
      "objetivo": [
        "forca",
        "core"
      ],
      "peso": 4
    },
    {
      "nome": "Bear crawl + parada isomÃ©trica (4x10m)",
      "subgrupo": "controle",
      "equipamentos": [],
      "objetivo": [
        "core",
        "mobilidade"
      ],
      "peso": 3
    }
  ],
  "cardio": [
    {
      "nome": "Corda (3x1min)",
      "subgrupo": "cardio",
      "equipamentos": [
        "corda"
      ],
      "objetivo": [
        "condicionamento"
      ],
      "peso": 3
    },
    {
      "nome": "Corrida no lugar (2x2min)",
      "subgrupo": "cardio",
      "equipamentos": [],
      "objetivo": [
        "resistencia"
      ],
      "peso": 2
    },
    {
      "nome": "Sacos alternados (3x30s)",
      "subgrupo": "intensidade",
      "equipamentos": [
        "saco"
      ],
      "objetivo": [
        "coordenaÃ§Ã£o"
      ],
      "peso": 3
    },
    {
      "nome": "Sprint na praÃ§a (5x40m)",
      "subgrupo": "cardio",
      "equipamentos": [],
      "objetivo": [
        "velocidade"
      ],
      "peso": 3
    },
    {
      "nome": "Burpee com salto (3x12)",
      "subgrupo": "cardio",
      "equipamentos": [],
      "objetivo": [
        "condicionamento"
      ],
      "peso": 4
    },
    {
      "nome": "Deslocamento lateral rÃ¡pido (4x30s)",
      "subgrupo": "agilidade",
      "equipamentos": [],
      "objetivo": [
        "explosÃ£o"
      ],
      "peso": 3
    },
    {
      "nome": "Corrida com parada e volta (3x1min)",
      "subgrupo": "resistencia",
      "equipamentos": [],
      "objetivo": [
        "agilidade"
      ],
      "peso": 3
    }
  ],
  "joelho": [
    {
      "nome": "Agachamento isomÃ©trico (3x30s)",
      "subgrupo": "forca",
      "equipamentos": [],
      "objetivo": [
        "estabilidade"
      ],
      "peso": 2
    },
    {
      "nome": "Ponte unilateral (2x12)",
      "subgrupo": "estabilidade",
      "equipamentos": [],
      "objetivo": [
        "controle motor"
      ],
      "peso": 2
    },
    {
      "nome": "ExtensÃ£o com peso (2x15)",
      "subgrupo": "isolamento",
      "equipamentos": [
        "halteres"
      ],
      "objetivo": [
        "reabilitaÃ§Ã£o"
      ],
      "peso": 2
    },
    {
      "nome": "Agachamento com apoio (3x15)",
      "subgrupo": "reabilitaÃ§Ã£o",
      "equipamentos": [],
      "objetivo": [
        "estabilidade"
      ],
      "peso": 2
    },
    {
      "nome": "Descida unilateral controlada (3x10)",
      "subgrupo": "controle",
      "equipamentos": [],
      "objetivo": [
        "reabilitaÃ§Ã£o",
        "equilibrio"
      ],
      "peso": 3
    },
    {
      "nome": "AvanÃ§o isomÃ©trico (3x30s)",
      "subgrupo": "forca",
      "equipamentos": [],
      "objetivo": [
        "controle"
      ],
      "peso": 2
    },
    {
      "nome": "Step up na praÃ§a (3x12)",
      "subgrupo": "forca",
      "equipamentos": [
        "banco"
      ],
      "objetivo": [
        "forca",
        "estabilidade"
      ],
      "peso": 3
    }
  ],
  "dedos": [
    {
      "nome": "PinÃ§a manual (2x20s)",
      "subgrupo": "pegada",
      "equipamentos": [
        "pinÃ§a"
      ],
      "objetivo": [
        "pegada"
      ],
      "peso": 2
    },
    {
      "nome": "ElÃ¡stico de dedos (3x15)",
      "subgrupo": "pegada",
      "equipamentos": [
        "elastico"
      ],
      "objetivo": [
        "mobilidade",
        "pegada"
      ],
      "peso": 1
    },
    {
      "nome": "Pegador de mÃ£o (atÃ© falha x2)",
      "subgrupo": "forca",
      "equipamentos": [
        "pegador"
      ],
      "objetivo": [
        "pegada"
      ],
      "peso": 3
    },
    {
      "nome": "TorÃ§Ã£o de toalha molhada (3x30s)",
      "subgrupo": "resistencia",
      "equipamentos": [
        "toalha"
      ],
      "objetivo": [
        "pegada",
        "resistencia"
      ],
      "peso": 2
    },
    {
      "nome": "Isometria de pegada com elÃ¡stico (3x30s)",
      "subgrupo": "pegada",
      "equipamentos": [
        "elastico"
      ],
      "objetivo": [
        "resistencia"
      ],
      "peso": 2
    },
    {
      "nome": "Pull-up estÃ¡tico (3x10s)",
      "subgrupo": "pegada",
      "equipamentos": [
        "barra"
      ],
      "objetivo": [
        "forca",
        "resistencia"
      ],
      "peso": 3
    },
    {
      "nome": "Pegada no pano de kimono (3x20s)",
      "subgrupo": "jiujitsu",
      "equipamentos": [
        "kimono"
      ],
      "objetivo": [
        "realismo",
        "pegada"
      ],
      "peso": 2
    }
  ]
};

    async function carregarDados() {
    return dadosTreinos
    }

    function getPerfil() {
      return JSON.parse(localStorage.getItem("perfil_usuario") || "{}");
    }

    function getUltimosTreinos() {
      const dias = Object.keys(localStorage)
        .filter(k => k.startsWith("treino_"))
        .map(k => ({ data: k.replace("treino_", ""), grupo: JSON.parse(localStorage[k]).grupo }))
        .sort((a,b)=> b.data.localeCompare(a.data));
      return dias.slice(0, 2).map(t => t.grupo);
    }

    async function sugerirGrupo() {
      const tempo = parseInt(document.getElementById("tempo").value);
      const intensidade = document.getElementById("intensidade").value;
      const fatorI = { leve: 1, media: 2, intensa: 3 }[intensidade];
      const fatorT = tempo / 15;
      const perfil = getPerfil();
      const cooldown = getUltimosTreinos();

      const score = {};
      for (const grupo in dadosTreinos) {
        score[grupo] = 0;
      }

      Object.keys(localStorage).filter(k => k.startsWith("treino_")).forEach(k => {
        const t = JSON.parse(localStorage.getItem(k));
        if (t?.grupo && t?.lista?.length) {
          const fi = { leve: 1, media: 2, intensa: 3 }[t.intensidade] || 1;
          const ft = t.tempo / 15 || 1;
          score[t.grupo] += t.lista.reduce((sum, ex) => sum + (ex.peso || 2), 0) * fi * ft;
        }
      });

      const gruposValidos = Object.keys(dadosTreinos).filter(grupo => !cooldown.includes(grupo));
      const candidatos = gruposValidos.map(g => ({ grupo: g, score: score[g] }));
      candidatos.sort((a,b)=> a.score - b.score);
      const escolhido = candidatos[0]?.grupo || "core";

      window.grupoSugerido = escolhido;

      let saida = `<h3>ğŸ“Œ Grupo Sugerido: ${escolhido.toUpperCase()}</h3>`;
      saida += `<p>Cooldown ativo: ${cooldown.join(", ") || "nenhum"}</p>`;
      saida += "<ul>";
      candidatos.forEach(c => saida += `<li>${c.grupo.toUpperCase()}: ${c.score.toFixed(1)}</li>`);
      saida += "</ul>";
      document.getElementById("sugestao").innerHTML = saida;
    }

    function gerarTreino() {
      const tempo = parseInt(document.getElementById("tempo").value);
      const intensidade = document.getElementById("intensidade").value;
      const grupo = window.grupoSugerido || "core";
      const dia = new Date().toISOString().slice(0,10);
      const perfil = getPerfil();
      const fatorI = { leve: 1, media: 2, intensa: 3 }[intensidade];

      const base = dadosTreinos[grupo].filter(ex => {
        if (perfil.equipamento?.length) {
          return ex.equipamentos.every(eq => perfil.equipamento.includes(eq));
        }
        return true;
      });

      const qtd = Math.min(Math.ceil((tempo / 15) + fatorI), base.length);
      const lista = base.slice(0, qtd);
      localStorage.setItem("treino_" + dia, JSON.stringify({tempo, intensidade, grupo, feitos: [], lista}));
      mostrarTreino(dia);
    }

    function mostrarTreino(dia) {
      const t = JSON.parse(localStorage.getItem("treino_" + dia));
      const lista = t.lista.map((ex, i) => {
        const c = t.feitos.includes(i) ? "checked" : "";
        return `<li><label><input type="checkbox" onchange="check(${i})" ${c}/> ${ex.nome}</label></li>`;
      }).join("");
      document.getElementById("treino").innerHTML = `<h3>${dia} - ${t.grupo.toUpperCase()}</h3><p>${t.tempo}min | ${t.intensidade}</p><ul class="checklist">${lista}</ul>`;
    }

    function check(i) {
      const dia = new Date().toISOString().slice(0, 10);
      const t = JSON.parse(localStorage.getItem("treino_" + dia));
      if (t.feitos.includes(i)) t.feitos = t.feitos.filter(x => x !== i);
      else t.feitos.push(i);
      localStorage.setItem("treino_" + dia, JSON.stringify(t));
      mostrarTreino(dia);
    }

    function exportarTreino() {
      let txt = "";
      Object.keys(localStorage).filter(k => k.startsWith("treino_")).sort().forEach(k => {
        const dia = k.replace("treino_", "");
        const t = JSON.parse(localStorage.getItem(k));
        txt += `=== ${dia} ===\\nGrupo: ${t.grupo}\\nTempo: ${t.tempo}min | Intensidade: ${t.intensidade}\\n`;
        t.lista.forEach((ex, i) => {
          const mark = t.feitos.includes(i) ? "âœ“" : "â˜";
          txt += `${mark} ${ex.nome}\\n`;
        });
        txt += `\\n`;
      });
      const blob = new Blob([txt], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "historico_caverna_bjj.txt";
      a.click();
      URL.revokeObjectURL(url);
    }

    carregarDados().then(() => {
      const hoje = new Date().toISOString().slice(0, 10);
      if (localStorage.getItem("treino_" + hoje)) mostrarTreino(hoje);
    });

    function salvarPerfil() {
  function getMarcados(id) {
    return Array.from(document.querySelectorAll(`#${id} input:checked`)).map(el => el.value);
  }

  const nome = document.getElementById("nomePerfil").value.trim();
  if (!nome) {
    alert("Por favor, preencha o campo de nome.");
    return;
  }

  const locaisMarcados = getMarcados("locais");
  if (locaisMarcados.length === 0) {
    alert("Por favor, selecione pelo menos um local.");
    return;
  }

  const equipamentosMarcados = getMarcados("equipamentos");
  if (equipamentosMarcados.length === 0) {
    alert("Por favor, selecione pelo menos um equipamento.");
    return;
  }

  const objetivosMarcados = getMarcados("objetivos");
  if (objetivosMarcados.length === 0) {
    alert("Por favor, selecione pelo menos um objetivo.");
    return;
  }

  const perfil = {
    nome: nome,
    locais: locaisMarcados,
    equipamento: equipamentosMarcados,
    objetivos: objetivosMarcados,
  };

  localStorage.setItem("perfil_usuario", JSON.stringify(perfil));
  alert("Perfil salvo com sucesso!");
  document.getElementById("perfilCard").style.display = "none";
  document.getElementById("mainCard").style.display = "block";
}

  function editarPerfil() {
    const perfil = JSON.parse(localStorage.getItem("perfil_usuario") || "{}");

    document.getElementById("nomePerfil").value = perfil.nome || "";

    const selects = [
      { id: "locais", valores: perfil.locais || [] },
      { id: "equipamentos", valores: perfil.equipamento || [] },
      { id: "objetivos", valores: perfil.objetivos || [] },
    ];

    selects.forEach(sel => {
      const el = document.getElementById(sel.id);
      Array.from(el.options).forEach(opt => {
        opt.selected = sel.valores.includes(opt.value);
      });
    });

    document.getElementById("perfilCard").style.display = "block";
    document.getElementById("mainCard").style.display = "none";

  }

  window.onload = () => {
    const perfil = JSON.parse(localStorage.getItem("perfil_usuario") || "{}");

    console.log("perfil", !perfil.nome);

    if (!perfil.nome) {
      console.log("Perfil nÃ£o encontrado. Exibindo tela de configuraÃ§Ã£o.");
      document.getElementById("perfilCard").style.display = "block";
      document.getElementById("mainCard").style.display = "none";
    } else {
      document.getElementById("nomePerfil").value = perfil.nome;
      document.getElementById("perfilCard").style.display = "none";
      document.getElementById("mainCard").style.display = "block";
    }
  };
  </script>
</body>
</html>
