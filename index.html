<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Caverna BJJ</title>
  <link rel="manifest" href="manifest.json" />
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 20px;
      color: #222;
    }
    h1 {
      text-align: center;
      color: #002b5c;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: 20px auto;
    }
    select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #004085;
      color: white;
      font-weight: bold;
      border: none;
    }
    button:hover {
      background: #002b5c;
    }
    .treino {
      margin-top: 20px;
    }
    .treino ul {
      padding-left: 20px;
    }
    .checklist input {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>Caverna BJJ</h1>
  <div class="card">
    <label for="tempo">Quanto tempo você tem hoje?</label>
    <select id="tempo">
      <option value="15">15 minutos</option>
      <option value="30">30 minutos</option>
      <option value="45">45 minutos</option>
      <option value="60">60 minutos</option>
    </select>

    <label for="intensidade">Qual intensidade você quer?</label>
    <select id="intensidade">
      <option value="leve">Leve</option>
      <option value="media">Média</option>
      <option value="intensa">Intensa</option>
    </select>

    <button onclick="gerarTreino()">Gerar Treino do Dia</button>
    <button onclick="exportarTreino()">Exportar Histórico</button>

    <div class="treino" id="treino"></div>
  </div>

  <script>
    
    const treinos = {
  ombro: [
    "Wall Angels (3x15)",
    "Shrug com halteres (3x12)",
    "Elevação lateral com tornozeleira (2x15)",
    "Rotação externa com elástico (2x20)",
    "Elevação frontal com halteres (2x15)",
    "Press militar com barra (3x10)",
    "Pêndulo com peso leve (2x30s)"
  ],
  core: [
    "Prancha frontal (3x30s)",
    "Canivete (3x15)",
    "Abdominal inclinado com peso (3x20)",
    "Prancha com toque no ombro (2x40s)",
    "Abdominal bicicleta (3x20)",
    "Prancha lateral (2x30s cada lado)",
    "Elevação de pernas no banco inclinado (3x12)"
  ],
  pernas: [
    "Agachamento com halteres (3x12)",
    "Passada com tornozeleira (3x10 cada perna)",
    "Adutor com elástico (3x15)",
    "Stiff com kettlebell (3x10)",
    "Agachamento búlgaro com apoio (2x10 cada perna)",
    "Cadeira imaginária na parede (2x45s)",
    "Ponte de glúteo com elevação (3x15)"
  ],
  fullbody: [
    "Burpee + saco de pancada (4x30s)",
    "Jumping Jack + prancha alternada (3x45s)",
    "Circuito 5 min: agacha + soca + pula corda",
    "Sprawl explosivo (3x10)",
    "Escalada no solo (mountain climber 3x40s)",
    "Corda alternada + prancha (4x1min)",
    "Agacha + upa (movimento técnico 3x10)"
  ],
  cardio: [
    "Corda (3x1min)",
    "Corrida no lugar (3x2min)",
    "Socos alternados no saco (4x30s)",
    "Pular corda com variações (2x2min)",
    "Trote com mudança de direção (4x1min)",
    "Escada de agilidade simulada (3x40s)",
    "Agacha + sprint no quintal (3x ida e volta)"
  ],
  joelho: [
    "Agachamento isométrico (3x30s)",
    "Ponte unilateral (2x12)",
    "Extensão com peso (2x15)",
    "Agacha + elevação de calcanhar (3x12)",
    "Descer devagar da ponta do pé (3x10)",
    "Marcha lenta controlada (2x2min)",
    "Agacha encostado na parede + contração (3x20s)"
  ],
  dedos: [
    "Pinça manual (2x20s)",
    "Elástico de dedos (3x15)",
    "Pegador de mão (até falha x2)",
    "Toalha enrolada + aperto (3x30s)",
    "Pegada na barra fixa por tempo (2x até fadiga)",
    "Espirrar elástico com dedos (3x10)",
    "Prender bola de tênis contra a parede (3x20s)"
  ]
};



    function grupoMaisDescansado() {
      const ordem = ["ombro", "core", "pernas", "fullbody", "joelho", "dedos", "cardio"];
      const hoje = new Date().toISOString().slice(0, 10);
      const treinosFeitos = Object.keys(localStorage).filter(k => k.startsWith("treino_") && k !== "treino_" + hoje);
      const gruposFeitos = treinosFeitos.map(k => JSON.parse(localStorage.getItem(k)).grupo);
      const gruposRestantes = ordem.filter(g => !gruposFeitos.includes(g));
      if (gruposRestantes.length === 0) {
        alert("Você treinou todos os grupos. Bora Reiniciar o Ciclo!");
        return ordem[Math.floor(Math.random() * ordem.length)];
      }
      const gruposContados = gruposRestantes.reduce((acc, g) => {
        acc[g] = (acc[g] || 0) + 1;
        return acc;
      }, {});
      const gruposOrdenados = Object.entries(gruposContados).sort((a, b) => a[1] - b[1]);
      const menosFeito = gruposOrdenados[0][0];
      return menosFeito;
    }

    function gerarTreino() {
      const tempo = parseInt(document.getElementById("tempo").value);
      const intensidade = document.getElementById("intensidade").value;
      const grupo = grupoMaisDescansado();
      const base = treinos[grupo];
      const dia = new Date().toISOString().slice(0, 10);

      let qtd;
      if (tempo <= 15) {
        qtd = 2;
      } else if (tempo <= 30) {
        qtd = 3;
      } else if (tempo <= 45){
        qtd = 4;
      } else {
        qtd = 5; // Add this line to handle cases above 45 minutes
      }
      if (intensidade === "leve") qtd -= 1;
      else if (intensidade === "media") qtd += 0;
      else
        qtd += 1; // For "intensa"
      if (tempo > 30) qtd += 1;
      if (tempo > 45) qtd += 1;
      if (tempo > 60) qtd += 1; // Adjusting for times above 60 minutes

      const selecionados = base.slice(0, qtd);
      localStorage.setItem("treino_" + dia, JSON.stringify({tempo, intensidade, grupo, feitos: [], lista: selecionados}));

      mostrarTreino(dia);
    }

    function mostrarTreino(dia) {
      const treino = JSON.parse(localStorage.getItem("treino_" + dia));
      if (!treino) return;

      const lista = treino.lista.map((ex, i) => {
        const checked = treino.feitos.includes(i) ? "checked" : "";
        return `<li><label><input type="checkbox" onchange="checkItem(${i})" ${checked}/> ${ex}</label></li>`;
      }).join("");

      document.getElementById("treino").innerHTML = `
        <h3>${dia} - Foco: ${treino.grupo.toUpperCase()}</h3>
        <p>Tempo: ${treino.tempo}min | Intensidade: ${treino.intensidade}</p>
        <ul class="checklist">${lista}</ul>
      `;
    }

    function checkItem(idx) {
      const dia = new Date().toISOString().slice(0, 10);
      const treino = JSON.parse(localStorage.getItem("treino_" + dia));
      if (!treino.feitos.includes(idx)) treino.feitos.push(idx);
      else treino.feitos = treino.feitos.filter(i => i !== idx);
      localStorage.setItem("treino_" + dia, JSON.stringify(treino));
      mostrarTreino(dia);
    }

    function exportarTreino() {
      let txt = "";
      Object.keys(localStorage).filter(k => k.startsWith("treino_")).sort().forEach(key => {
        const dia = key.replace("treino_", "");
        const t = JSON.parse(localStorage.getItem(key));
        txt += `=== ${dia} ===\nGrupo: ${t.grupo}\nTempo: ${t.tempo}min | Intensidade: ${t.intensidade}\n`;
        t.lista.forEach((ex, i) => {
          const mark = t.feitos.includes(i) ? "✓" : "☐";
          txt += `${mark} ${ex}\n`;
        });
        txt += `\n`;
      });

      const blob = new Blob([txt], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "historico_caverna_bjj.txt";
      a.click();
      URL.revokeObjectURL(url);
    }

    window.onload = () => {
      const hoje = new Date().toISOString().slice(0, 10);
      if (localStorage.getItem("treino_" + hoje)) {
        mostrarTreino(hoje);
      }
    }
  </script>
</body>
</html>
